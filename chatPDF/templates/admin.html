{% extends 'base.html'%} {% block content %}

<div class="d-flex user">
    <div class="text-white admin-menu">
      <ul class="admin-menu-list">
        <li class="admin-item active">Quản lý File</li>
        <li class="admin-item">Quản lý phản hồi</li>
        <li class="admin-item">Quản lý tài khoản</li>
        <li class="admin-item">ChatPDF</li>
      </ul>
      <a href="{{url_for('login')}}" class="btn home-btn-text"
        >Đăng Nhập</a>
    </div>
    <div class="admin-content">
        <div class="admin-list active">
            <div class="scroll">
                <table class="table-bordered admin-content-table">
                    <thead>
                        <tr>
                          <th scope="col" style="width: 50px">#</th>
                          <th scope="col" style="width: 150px">Thời gian</th>
                          <th scope="col">File</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <th scope="row">1</th>
                          <td contenteditable="true">Mark</td>
                          <td contenteditable="true"><input type="file" name="pdf" accept=".pdf"></td>
                        </tr>
                      </tbody>
                  </table>
            </div>

              <div class="admin-btn d-flex justify-content-end m-5">
                <button class="btn ml-5 btn-add">Thêm</button>
                <button class="btn ml-5 btn-close">Xóa</button>
              </div>

        </div>
        <div class="admin-list">
            <div class="scroll">
                <table class="table-bordered admin-content-table">
                    <thead>
                        <tr>
                          <th scope="col" style="width: 50px">#</th>
                          <th scope="col" style="width: 300px">Email</th>
                          <th scope="col" style="width: 150px">Thời gian</th>
                          <th scope="col">Phản hồi</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <th scope="row">1</th>
                          <td contenteditable="true">Mark</td>
                          <td contenteditable="true">Otto</td>
                          <td contenteditable="true">Otto</td>
                        </tr>
                        <tr>
                          <th scope="row">1</th>
                          <td contenteditable="true">Mark</td>
                          <td contenteditable="true">Otto</td>
                          <td contenteditable="true">Otto</td>
                        </tr>
                        <tr>
                          <th scope="row">1</th>
                          <td contenteditable="true">Mark</td>
                          <td contenteditable="true">Otto</td>
                          <td contenteditable="true">Otto</td>
                        </tr>
                        
                      </tbody>
                  </table>
            </div>

              <div class="admin-btn d-flex justify-content-end m-5">
                <button class="btn ml-5 btn-close">Xóa</button>
              </div>

        </div>
        <div class="admin-list">
            <div class="scroll">
                <table class="table-bordered admin-content-table">
                    <thead>
                        <tr>
                          <th scope="col" style="width: 50px">STT</th>
                          <th scope="col" style="width: 300px">Tên tài khoản</th>
                          <th scope="col">Email</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <th scope="row">1</th>
                          <td>Mark</td>
                          <td>Otto</td>
                        </tr>
                       
                      </tbody>
                  </table>
            </div>
              <div class="admin-btn d-flex justify-content-end m-5">
                <button class="btn ml-5 btn-add">Thêm</button>
                <button class="btn ml-5 btn-close">Xóa</button>
              </div>
        </div>       
        <div class="admin-list">
          <div class="user-chatPDF-conversation scroll" id="scrollable-content">
              {% for conversation in conversations %}
              <div class="user-chat">
                <div class="chat-tk" style="display: flex; justify-content: flex-end;">
                  <span class="username">
                     <i class="fa-solid fa-user"></i>
                  </span>
                </div>
                <div class="chat-item chat-item-right">
                  <p class="chat-item-message">
                    {{ conversation.user_chat }}
                  </p>
                </div>
              </div>
        
              <div class="chat-chat">
                <div class="chat-AI">
                  <span>
                    <i class="fas fa-comment"></i>
                  </span>
                </div>
                <div class="chat-item chat-item-left">
                  <p class="chat-item-messageAI">
                    {{ conversation.bot_chat }}
                  </p>
                </div>
              </div>      
              {% endfor %}
          </div>
          <div class="chatPDF-message">
              <textarea id="messageInput" rows="1" placeholder="Send a message" class=""></textarea>
              <button class="chatPDF-message-btn" id="sendMessageButton">
                <i class="fas fa-play"></i>
              </button>
          </div>
        </div>
    </div>
</div>
<script>
    const adminItems = document.querySelectorAll(".admin-item");
    const adminLists = document.querySelectorAll(".admin-list");
    adminItems.forEach((item, index) => {
      const adList = adminLists[index];
      item.onclick = function () {
         document.querySelector(".admin-item.active").classList.remove("active");
         document.querySelector(".admin-list.active").classList.remove("active");

        this.classList.add("active");
        adList.classList.add("active");
      };
    });
  </script>

<script>
  // Gửi tin nhắn
  const messageInput = document.getElementById('messageInput');
  const sendMessageButton = document.getElementById('sendMessageButton');
  const conversationContainer = document.querySelector('.user-chatPDF-conversation');

  sendMessageButton.addEventListener('click', function () {
    const user_chat = messageInput.value;
    if (user_chat != ""){
    const bot_chat = 'chat';
    messageInput.value = '';

    const userChatDiv = document.createElement('div');
    userChatDiv.className = 'user-chat';
    userChatDiv.innerHTML = `
        <div class="chat-tk" style="display: flex; justify-content: flex-end;" id="scrollable-content">
          <span class="username">
            <i class="fa-solid fa-user"></i>
            </span>
        </div>
        <div class="chat-item chat-item-right">
                <p class="chat-item-message">
                  ${user_chat}
                <p>
              </div>
      `;
    conversationContainer.appendChild(userChatDiv);

    const chatChatDiv = document.createElement('div');
    chatChatDiv.className = 'chat-chat';
    conversationContainer.appendChild(chatChatDiv);
    chatChatDiv.innerHTML = `
        <div class="chat-AI">
          <span>
            <i class="fas fa-comment"></i>
          </span>
        </div>
        
        <div class="chat-item chat-item-left">
                <p class="chat-item-messageAI">
                  <i class="fa-solid fa-spinner fa-spin"></i>
                <p>
        </div>
      `;

    fetch('/add_conversation', {
      method: 'POST',
      body: JSON.stringify({ user_chat: user_chat }),
      headers: {
        'Content-Type': 'application/json'
      }
    })
      .then(res => res.json())
      .then(data => {
        showResponse(data.bot_chat, chatChatDiv);
           
      });
    }
  });

  function showResponse(response, chatchatDiv){
    const words = response.split(' ');
    let index = 0;
    const chatItemMessageAI = chatchatDiv.querySelector('.chat-item-left .chat-item-messageAI');
    function displayWord(){
      if (index === 0){
        chatItemMessageAI.innerHTML = words[index];
      }else{
        chatItemMessageAI.innerHTML += ' ' + words[index];
      }
      index++;
      if(index < words.length){
        setTimeout(displayWord, 150)
      }
    }
    displayWord();
  }
</script>

  <script>
    var scrollableContent = document.getElementById('scrollable-content')
    scrollableContent.scrollTop = scrollableContent.scrollHeight;
  </script>

{% endblock %}
